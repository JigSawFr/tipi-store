{
  "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
  "schemaVersion": 2,
  "services": [
    {
      "image": "ghcr.io/paperless-ngx/paperless-ngx:2.20.0",
      "name": "paperless-ngx",
      "isMain": true,
      "internalPort": 8000,
      "dependsOn": [
        "paperless-ngx-db",
        "paperless-ngx-broker",
        "paperless-ngx-gotenberg",
        "paperless-ngx-tika"
      ],
      "environment": [
        {
          "key": "COMPOSE_PROJECT_NAME",
          "value": "${APP_ID}"
        },
        {
          "key": "USERMAP_UID",
          "value": 1000
        },
        {
          "key": "USERMAP_GID",
          "value": 1000
        },
        {
          "key": "PAPERLESS_REDIS",
          "value": "redis://paperless-ngx-broker:6379"
        },
        {
          "key": "PAPERLESS_DBHOST",
          "value": "paperless-ngx-db"
        },
        {
          "key": "PAPERLESS_ADMIN_USER",
          "value": "${PAPERLESS_ADMIN_USERNAME}"
        },
        {
          "key": "PAPERLESS_ADMIN_PASSWORD",
          "value": "${PAPERLESS_ADMIN_PASSWORD}"
        },
        {
          "key": "PAPERLESS_TIKA_ENABLED",
          "value": "${PAPERLESS_TIKA_ENABLED:-false}"
        },
        {
          "key": "PAPERLESS_TIKA_GOTENBERG_ENDPOINT",
          "value": "http://paperless-ngx-gotenberg:3000"
        },
        {
          "key": "PAPERLESS_TIKA_ENDPOINT",
          "value": "http://paperless-ngx-tika:9998"
        },
        {
          "key": "PAPERLESS_URL",
          "value": "${APP_PROTOCOL:-http}://${APP_DOMAIN}"
        },
        {
          "key": "PAPERLESS_TIME_ZONE",
          "value": "${PAPERLESS_TIME_ZONE:-UTC}"
        },
        {
          "key": "PAPERLESS_OCR_LANGUAGE",
          "value": "${PAPERLESS_OCR_LANGUAGE:-eng}"
        },
        {
          "key": "PAPERLESS_OCR_LANGUAGES",
          "value": "${PAPERLESS_OCR_LANGUAGES:-eng}"
        },
        {
          "key": "PAPERLESS_OCR_MODE",
          "value": "${PAPERLESS_OCR_MODE:-skip}"
        },
        {
          "key": "PAPERLESS_OCR_OUTPUT_TYPE",
          "value": "${PAPERLESS_OCR_OUTPUT_TYPE:-pdfa}"
        },
        {
          "key": "PAPERLESS_OCR_ROTATE_PAGES",
          "value": "${PAPERLESS_OCR_ROTATE_PAGES:-true}"
        },
        {
          "key": "PAPERLESS_OCR_PAGES",
          "value": "${PAPERLESS_OCR_PAGES:-0}"
        },
        {
          "key": "PAPERLESS_OCR_SKIP_ARCHIVE_FILE",
          "value": "${PAPERLESS_OCR_SKIP_ARCHIVE_FILE:-never}"
        },
        {
          "key": "PAPERLESS_OCR_DESKEW",
          "value": "${PAPERLESS_OCR_DESKEW:-true}"
        },
        {
          "key": "PAPERLESS_OCR_CLEAN",
          "value": "${PAPERLESS_OCR_CLEAN:-clean}"
        },
        {
          "key": "PAPERLESS_OCR_USER_ARGS",
          "value": "${PAPERLESS_OCR_USER_ARGS:-{\"invalidate_digital_signatures\": true}}"
        },
        {
          "key": "PAPERLESS_CONSUMER_ENABLE_BARCODES",
          "value": "${PAPERLESS_CONSUMER_ENABLE_BARCODES:-false}"
        },
        {
          "key": "PAPERLESS_CONSUMER_BARCODE_TIFF_SUPPORT",
          "value": "${PAPERLESS_CONSUMER_BARCODE_TIFF_SUPPORT:-false}"
        },
        {
          "key": "PAPERLESS_CONSUMER_ENABLE_TAG_BARCODE",
          "value": "${PAPERLESS_CONSUMER_ENABLE_TAG_BARCODE:-false}"
        },
        {
          "key": "PAPERLESS_CONSUMER_BARCODE_DPI",
          "value": "${PAPERLESS_CONSUMER_BARCODE_DPI:-300}"
        },
        {
          "key": "PAPERLESS_CONSUMER_BARCODE_UPSCALE",
          "value": "${PAPERLESS_CONSUMER_BARCODE_UPSCALE:-0}"
        },
        {
          "key": "PAPERLESS_CONSUMER_ENABLE_ASN_BARCODE",
          "value": "${PAPERLESS_CONSUMER_ENABLE_ASN_BARCODE:-false}"
        },
        {
          "key": "PAPERLESS_CONSUMER_ASN_BARCODE_PREFIX",
          "value": "${PAPERLESS_CONSUMER_ASN_BARCODE_PREFIX:-ASN}"
        },
        {
          "key": "PAPERLESS_CONSUMER_BARCODE_STRING",
          "value": "${PAPERLESS_CONSUMER_BARCODE_STRING:-PATCHT}"
        },
        {
          "key": "PAPERLESS_CONSUMER_POLLING",
          "value": "${PAPERLESS_CONSUMER_POLLING:-5}"
        },
        {
          "key": "PAPERLESS_CONSUMER_DELETE_DUPLICATES",
          "value": "${PAPERLESS_CONSUMER_DELETE_DUPLICATES:-true}"
        },
        {
          "key": "PAPERLESS_CONSUMER_RECURSIVE",
          "value": "${PAPERLESS_CONSUMER_RECURSIVE:-true}"
        },
        {
          "key": "PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS",
          "value": "${PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS:-false}"
        },
        {
          "key": "PAPERLESS_CONSUMER_IGNORE_PATTERNS",
          "value": "${PAPERLESS_CONSUMER_IGNORE_PATTERNS:-[\".DS_STORE/*\", \"._*\", \".stfolder/*\", \".stversions/*\", \".localized/*\", \"desktop.ini\", \"@eaDir/*\", \"*_paperless_write_test_*\"]}"
        },
        {
          "key": "PAPERLESS_TASK_WORKERS",
          "value": "${PAPERLESS_TASK_WORKERS:-2}"
        },
        {
          "key": "PAPERLESS_THREADS_PER_WORKER",
          "value": "${PAPERLESS_THREADS_PER_WORKER:-4}"
        },
        {
          "key": "PAPERLESS_WORKER_TIMEOUT",
          "value": "${PAPERLESS_WORKER_TIMEOUT:-1800}"
        },
        {
          "key": "PAPERLESS_CONVERT_MEMORY_LIMIT",
          "value": "${PAPERLESS_CONVERT_MEMORY_LIMIT:-0}"
        },
        {
          "key": "PAPERLESS_EMAIL_TASK_CRON",
          "value": "${PAPERLESS_EMAIL_TASK_CRON:-*/10 * * * *}"
        },
        {
          "key": "PAPERLESS_TRAIN_TASK_CRON",
          "value": "${PAPERLESS_TRAIN_TASK_CRON:-5 */1 * * *}"
        },
        {
          "key": "PAPERLESS_INDEX_TASK_CRON",
          "value": "${PAPERLESS_INDEX_TASK_CRON:-0 0 * * *}"
        },
        {
          "key": "PAPERLESS_EMPTY_TRASH_DELAY",
          "value": "${PAPERLESS_EMPTY_TRASH_DELAY:-30}"
        },
        {
          "key": "PAPERLESS_ENABLE_UPDATE_CHECK",
          "value": "${PAPERLESS_ENABLE_UPDATE_CHECK:-true}"
        },
        {
          "key": "PAPERLESS_FILENAME_FORMAT_REMOVE_NONE",
          "value": "${PAPERLESS_FILENAME_FORMAT_REMOVE_NONE:-true}"
        },
        {
          "key": "PAPERLESS_SECRET_KEY",
          "value": "${PAPERLESS_SECRET_KEY:-}"
        },
        {
          "key": "PAPERLESS_CSRF_TRUSTED_ORIGINS",
          "value": "${APP_PROTOCOL-https}://*.${LOCAL_DOMAIN},${APP_PROTOCOL-https}://${APP_DOMAIN},http://${INTERNAL_IP}:${APP_PORT}"
        },
        {
          "key": "PAPERLESS_ALLOWED_HOSTS",
          "value": ".${LOCAL_DOMAIN},${APP_DOMAIN},${INTERNAL_IP}"
        }
      ],
      "healthCheck": {
        "test": "curl -fs -S --max-time 2 http://localhost:8000 || exit 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "startPeriod": "30s"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/data",
          "containerPath": "/usr/src/paperless/data"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/media",
          "containerPath": "/usr/src/paperless/media"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/export",
          "containerPath": "/usr/src/paperless/export"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/consume",
          "containerPath": "/usr/src/paperless/consume"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/postprocessor",
          "containerPath": "/usr/src/paperless/postprocessor"
        },
        {
          "hostPath": "${APP_DATA_DIR}/data/paperless/scripts",
          "containerPath": "/custom-cont-init.d",
          "readOnly": true
        }
      ]
    },
    {
      "image": "redis:8.0.2-alpine",
      "name": "paperless-ngx-broker",
      "command": [
        "redis-server",
        "--appendonly",
        "yes"
      ],
      "healthCheck": {
        "test": "redis-cli ping || exit 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "startPeriod": "30s"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/broker",
          "containerPath": "/data"
        }
      ]
    },
    {
      "image": "postgres:17.5-alpine",
      "name": "paperless-ngx-db",
      "environment": [
        {
          "key": "POSTGRES_DB",
          "value": "paperless"
        },
        {
          "key": "POSTGRES_USER",
          "value": "paperless"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "paperless"
        }
      ],
      "healthCheck": {
        "test": "pg_isready -d paperless -U paperless || exit 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "startPeriod": "30s"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/db",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    },
    {
      "image": "gotenberg/gotenberg:8.25.0-cloudrun",
      "name": "paperless-ngx-gotenberg",
      "command": [
        "gotenberg",
        "--chromium-disable-routes=true",
        "--chromium-allow-list=file:///tmp/.*",
        "--api-timeout=30s",
        "--libreoffice-restart-after=5",
        "--libreoffice-start-timeout=10s"
      ],
      "environment": [
        {
          "key": "PORT",
          "value": "3000"
        }
      ],
      "healthCheck": {
        "test": "timeout 5s bash -c ':> /dev/tcp/127.0.0.1/3000' || exit 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "startPeriod": "30s"
      }
    },
    {
      "image": "apache/tika:3.2.3.0-full",
      "name": "paperless-ngx-tika",
      "healthCheck": {
        "test": "timeout 5s bash -c ':> /dev/tcp/127.0.0.1/9998' || exit 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "startPeriod": "30s"
      }
    }
  ]
}
