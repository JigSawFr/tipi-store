{
    "$schema": "https://schemas.runtipi.io/v2/dynamic-compose.json",
    "schemaVersion": 2,
    "services": [
        {
            "image": "ghcr.io/jigsawfr/aiometadata-docker:1.17.0",
            "name": "aiometadata",
            "isMain": true,
            "internalPort": 1337,
            "environment": [
                {
                    "key": "PORT",
                    "value": "1337"
                },
                {
                    "key": "TMDB_API",
                    "value": "${AIOMETADATA_TMDB_API}"
                },
                {
                    "key": "TVDB_API_KEY",
                    "value": "${AIOMETADATA_TVDB_API_KEY}"
                },
                {
                    "key": "FANART_API_KEY",
                    "value": "${AIOMETADATA_FANART_API_KEY}"
                },
                {
                    "key": "MDBLIST_API_KEY",
                    "value": "${AIOMETADATA_MDBLIST_API_KEY}"
                },
                {
                    "key": "RPDB_API_KEY",
                    "value": "${AIOMETADATA_RPDB_API_KEY}"
                },
                {
                    "key": "HOST_NAME",
                    "value": "${AIOMETADATA_HOST_NAME:-${APP_PROTOCOL}://${APP_DOMAIN}}"
                },
                {
                    "key": "REDIS_URL",
                    "value": "redis://aiometadata_redis:6379"
                },
                {
                    "key": "DATABASE_URI",
                    "value": "sqlite://addon/data/db.sqlite"
                },
                {
                    "key": "ADMIN_KEY",
                    "value": "${AIOMETADATA_ADMIN_KEY}"
                },
                {
                    "key": "ADDON_PASSWORD",
                    "value": "${AIOMETADATA_ADDON_PASSWORD}"
                },
                {
                    "key": "GEMINI_API_KEY",
                    "value": "${AIOMETADATA_GEMINI_API_KEY}"
                },
                {
                    "key": "ANILIST_CLIENT_ID",
                    "value": "${AIOMETADATA_ANILIST_CLIENT_ID}"
                },
                {
                    "key": "ANILIST_CLIENT_SECRET",
                    "value": "${AIOMETADATA_ANILIST_CLIENT_SECRET}"
                },
                {
                    "key": "ANILIST_REDIRECT_URI",
                    "value": "${AIOMETADATA_ANILIST_REDIRECT_URI}"
                },
                {
                    "key": "TRAKT_CLIENT_ID",
                    "value": "${AIOMETADATA_TRAKT_CLIENT_ID}"
                },
                {
                    "key": "TRAKT_CLIENT_SECRET",
                    "value": "${AIOMETADATA_TRAKT_CLIENT_SECRET}"
                },
                {
                    "key": "TRAKT_REDIRECT_URI",
                    "value": "${AIOMETADATA_TRAKT_REDIRECT_URI}"
                },
                {
                    "key": "SOCKS_PROXY_URL",
                    "value": "${AIOMETADATA_SOCKS_PROXY_URL}"
                },
                {
                    "key": "META_TTL",
                    "value": "604800"
                },
                {
                    "key": "CATALOG_TTL",
                    "value": "86400"
                },
                {
                    "key": "CATALOG_LIST_ITEMS_SIZE",
                    "value": "20"
                },
                {
                    "key": "LOG_LEVEL",
                    "value": "info"
                },
                {
                    "key": "CACHE_WARM_INTERVAL_HOURS",
                    "value": "${AIOMETADATA_CACHE_WARM_INTERVAL_HOURS:-24}"
                },
                {
                    "key": "CACHE_WARM_LANGUAGE",
                    "value": "${AIOMETADATA_CACHE_WARM_LANGUAGE:-en-US}"
                },
                {
                    "key": "DISABLE_METRICS",
                    "value": "${AIOMETADATA_DISABLE_METRICS:-true}"
                }
            ],
            "volumes": [
                {
                    "hostPath": "${APP_DATA_DIR}/data/aiometadata/data",
                    "containerPath": "/app/addon/data"
                }
            ],
            "healthCheck": {
                "test": "wget -q --spider http://localhost:1337/api/cache/health || exit 1",
                "interval": "30s",
                "timeout": "10s",
                "retries": 3,
                "startPeriod": "60s"
            },
            "dependsOn": [
                "aiometadata_redis"
            ]
        },
        {
            "image": "redis:latest",
            "name": "aiometadata_redis",
            "isMain": false,
            "command": "redis-server --appendonly yes --save 60 1",
            "volumes": [
                {
                    "hostPath": "${APP_DATA_DIR}/data/aiometadata/cache",
                    "containerPath": "/data"
                }
            ],
            "healthCheck": {
                "test": "redis-cli ping",
                "interval": "10s",
                "timeout": "5s",
                "retries": 5
            }
        }
    ]
}